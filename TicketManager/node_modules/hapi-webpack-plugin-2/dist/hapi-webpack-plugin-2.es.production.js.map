{"version":3,"file":"hapi-webpack-plugin-2.es.production.js","sources":["../src/index.ts"],"sourcesContent":["import path from 'path';\nimport webpack from 'webpack';\nimport webpackDevMiddleware from 'webpack-dev-middleware';\nimport webpackHotMiddleware from 'webpack-hot-middleware';\nimport { Server, Plugin } from '@hapi/hapi';\nimport { NextHandleFunction } from 'connect';\n\ntype Config = {\n  compiler: webpack.ICompiler;\n  assets?: webpackDevMiddleware.Options;\n  hot?: webpackHotMiddleware.Options;\n};\n\ntype Options = {\n  config?: Config;\n  configPath?: string;\n};\n\ntype DevMiddleware = webpackDevMiddleware.WebpackDevMiddleware & NextHandleFunction;\ntype HotMiddleware = webpackHotMiddleware.EventStream & NextHandleFunction;\n\nconst createExtension = (server: Server, middleware: DevMiddleware | HotMiddleware) => {\n  server.ext({\n    type: 'onRequest',\n    method: (request, h) =>\n      new Promise((resolve, reject) => {\n        const { req, res } = request.raw;\n\n        middleware(req, res, err => {\n          return err ? reject(err) : resolve(h.continue);\n        });\n      }),\n  });\n};\n\nconst getConfig = (options: Options): Config => {\n  if (options.configPath) {\n    const config = require(path.resolve(process.cwd(), options.configPath));\n\n    return {\n      compiler: webpack(config),\n      assets: config.assets,\n      hot: config.hot,\n    };\n  } else if (options.config) {\n    return options.config;\n  } else {\n    throw new Error('No config or configPath provided.');\n  }\n};\n\nfunction register(server: Server, options: Options) {\n  const { compiler, assets, hot } = getConfig(options);\n\n  createExtension(server, webpackDevMiddleware(compiler, assets));\n  createExtension(server, webpackHotMiddleware(compiler, hot));\n\n  server.expose({ compiler });\n}\n\nconst HapiWebpackPlugin: Plugin<Options> = {\n  name: 'hapi-webpack-plugin-2',\n  version: '1.0.2',\n  once: true,\n  register,\n};\n\nexport default HapiWebpackPlugin;\n"],"names":["createExtension","server","middleware","ext","type","method","request","h","Promise","resolve","reject","raw","req","res","err","name","version","once","register","options","configPath","config","require","path","process","cwd","compiler","webpack","assets","hot","Error","getConfig","webpackDevMiddleware","webpackHotMiddleware","expose"],"mappings":"uHAqBA,IAAMA,EAAkB,SAACC,EAAgBC,GACvCD,EAAOE,IAAI,CACTC,KAAM,YACNC,OAAQ,SAACC,EAASC,UAChB,IAAIC,QAAQ,SAACC,EAASC,SACCJ,EAAQK,IAE7BT,IAFQU,MAAKC,IAEQ,SAAAC,UACZA,EAAMJ,EAAOI,GAAOL,EAAQF,kCA+BF,CACzCQ,KAAM,wBACNC,QAAS,QACTC,MAAM,EACNC,SAbF,SAAkBjB,EAAgBkB,SAhBhB,SAACA,MACbA,EAAQC,WAAY,KAChBC,EAASC,QAAQC,EAAKd,QAAQe,QAAQC,MAAON,EAAQC,mBAEpD,CACLM,SAAUC,EAAQN,GAClBO,OAAQP,EAAOO,OACfC,IAAKR,EAAOQ,KAET,GAAIV,EAAQE,cACVF,EAAQE,aAET,IAAIS,MAAM,qCAKgBC,CAAUZ,GAApCO,IAAAA,SAAkBG,IAAAA,IAE1B7B,EAAgBC,EAAQ+B,EAAqBN,IAF3BE,SAGlB5B,EAAgBC,EAAQgC,EAAqBP,EAAUG,IAEvD5B,EAAOiC,OAAO,CAAER,SAAAA"}