{"version":3,"file":"hapi-webpack-plugin-2.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import path from 'path';\nimport webpack from 'webpack';\nimport webpackDevMiddleware from 'webpack-dev-middleware';\nimport webpackHotMiddleware from 'webpack-hot-middleware';\nimport { Server, Plugin } from '@hapi/hapi';\nimport { NextHandleFunction } from 'connect';\n\ntype Config = {\n  compiler: webpack.ICompiler;\n  assets?: webpackDevMiddleware.Options;\n  hot?: webpackHotMiddleware.Options;\n};\n\ntype Options = {\n  config?: Config;\n  configPath?: string;\n};\n\ntype DevMiddleware = webpackDevMiddleware.WebpackDevMiddleware & NextHandleFunction;\ntype HotMiddleware = webpackHotMiddleware.EventStream & NextHandleFunction;\n\nconst createExtension = (server: Server, middleware: DevMiddleware | HotMiddleware) => {\n  server.ext({\n    type: 'onRequest',\n    method: (request, h) =>\n      new Promise((resolve, reject) => {\n        const { req, res } = request.raw;\n\n        middleware(req, res, err => {\n          return err ? reject(err) : resolve(h.continue);\n        });\n      }),\n  });\n};\n\nconst getConfig = (options: Options): Config => {\n  if (options.configPath) {\n    const config = require(path.resolve(process.cwd(), options.configPath));\n\n    return {\n      compiler: webpack(config),\n      assets: config.assets,\n      hot: config.hot,\n    };\n  } else if (options.config) {\n    return options.config;\n  } else {\n    throw new Error('No config or configPath provided.');\n  }\n};\n\nfunction register(server: Server, options: Options) {\n  const { compiler, assets, hot } = getConfig(options);\n\n  createExtension(server, webpackDevMiddleware(compiler, assets));\n  createExtension(server, webpackHotMiddleware(compiler, hot));\n\n  server.expose({ compiler });\n}\n\nconst HapiWebpackPlugin: Plugin<Options> = {\n  name: 'hapi-webpack-plugin-2',\n  version: '1.0.2',\n  once: true,\n  register,\n};\n\nexport default HapiWebpackPlugin;\n"],"names":["createExtension","server","middleware","ext","type","method","request","h","Promise","resolve","reject","raw","req","res","err","getConfig","options","configPath","config","require","path","process","cwd","compiler","webpack","assets","hot","Error","register","webpackDevMiddleware","webpackHotMiddleware","expose","HapiWebpackPlugin","name","version","once"],"mappings":";;;;;;;;;AAqBA,IAAMA,eAAe,GAAG,SAAlBA,eAAkB,CAACC,MAAD,EAAiBC,UAAjB;EACtBD,MAAM,CAACE,GAAP,CAAW;IACTC,IAAI,EAAE,WADG;IAETC,MAAM,EAAE,gBAACC,OAAD,EAAUC,CAAV;aACN,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV;2BACWJ,OAAO,CAACK;YAArBC,mBAAAA;YAAKC,mBAAAA;QAEbX,UAAU,CAACU,GAAD,EAAMC,GAAN,EAAW,UAAAC,GAAG;iBACfA,GAAG,GAAGJ,MAAM,CAACI,GAAD,CAAT,GAAiBL,OAAO,CAACF,CAAC,YAAF,CAAlC;SADQ,CAAV;OAHF,CADM;;GAFV;CADF;;AAcA,IAAMQ,SAAS,GAAG,SAAZA,SAAY,CAACC,OAAD;MACZA,OAAO,CAACC,UAAZ,EAAwB;QAChBC,MAAM,GAAGC,OAAO,CAACC,IAAI,CAACX,OAAL,CAAaY,OAAO,CAACC,GAAR,EAAb,EAA4BN,OAAO,CAACC,UAApC,CAAD,CAAtB;;WAEO;MACLM,QAAQ,EAAEC,OAAO,CAACN,MAAD,CADZ;MAELO,MAAM,EAAEP,MAAM,CAACO,MAFV;MAGLC,GAAG,EAAER,MAAM,CAACQ;KAHd;GAHF,MAQO,IAAIV,OAAO,CAACE,MAAZ,EAAoB;WAClBF,OAAO,CAACE,MAAf;GADK,MAEA;UACC,IAAIS,KAAJ,CAAU,mCAAV,CAAN;;CAZJ;;AAgBA,SAASC,QAAT,CAAkB3B,MAAlB,EAAkCe,OAAlC;mBACoCD,SAAS,CAACC,OAAD;MAAnCO,sBAAAA;MAAUE,oBAAAA;MAAQC,iBAAAA;;EAE1B1B,eAAe,CAACC,MAAD,EAAS4B,oBAAoB,CAACN,QAAD,EAAWE,MAAX,CAA7B,CAAf;EACAzB,eAAe,CAACC,MAAD,EAAS6B,oBAAoB,CAACP,QAAD,EAAWG,GAAX,CAA7B,CAAf;EAEAzB,MAAM,CAAC8B,MAAP,CAAc;IAAER,QAAQ,EAARA;GAAhB;;;AAGF,IAAMS,iBAAiB,GAAoB;EACzCC,IAAI,EAAE,uBADmC;EAEzCC,OAAO,EAAE,OAFgC;EAGzCC,IAAI,EAAE,IAHmC;EAIzCP,QAAQ,EAARA;CAJF;;;;"}